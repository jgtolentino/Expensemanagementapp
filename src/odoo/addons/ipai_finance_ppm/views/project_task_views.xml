<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- 
        Finance PPM Task Views with Deakin Theme
        Uses Deakin Enterprise 365 design system classes
    -->
    
    <!-- WBS Tree View -->
    <record id="view_project_task_tree_deakin" model="ir.ui.view">
        <field name="name">project.task.tree.deakin.finance.ppm</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_tree2"/>
        <field name="arch" type="xml">
            <!-- Apply Deakin data-table styling -->
            <xpath expr="//tree" position="attributes">
                <attribute name="class">data-table</attribute>
                <attribute name="decoration-bf">x_task_type == 'phase'</attribute>
                <attribute name="decoration-info">x_task_type == 'checklist'</attribute>
                <attribute name="decoration-success">progress == 100</attribute>
                <attribute name="decoration-warning">progress > 0 and progress < 100</attribute>
                <attribute name="decoration-danger">date_deadline < current_date and progress < 100</attribute>
            </xpath>
            
            <!-- Add WBS columns if custom fields exist -->
            <xpath expr="//field[@name='name']" position="before">
                <field name="x_wbs_code" optional="show" string="WBS"/>
                <field name="x_task_ref" optional="show" string="ID"/>
            </xpath>
            
            <xpath expr="//field[@name='name']" position="after">
                <field name="x_task_type" optional="show" string="Type"/>
                <field name="progress" widget="progressbar" optional="show"/>
                <field name="x_accountable_id" optional="show" string="Accountable"/>
            </xpath>
        </field>
    </record>
    
    <!-- Kanban View with Task Cards -->
    <record id="view_project_task_kanban_deakin" model="ir.ui.view">
        <field name="name">project.task.kanban.deakin.finance.ppm</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="class">o_kanban_small_column</attribute>
            </xpath>
            
            <!-- Apply task-card styling -->
            <xpath expr="//templates/t[@t-name='kanban-box']" position="attributes">
                <attribute name="class">task-card</attribute>
            </xpath>
            
            <xpath expr="//templates/t[@t-name='kanban-box']/div[hasclass('oe_kanban_content')]" position="replace">
                <div class="task-card">
                    <!-- Task Label/Tag -->
                    <div t-if="record.x_task_type.raw_value" class="tag tag--gold">
                        <t t-esc="record.x_task_type.value"/>
                    </div>
                    
                    <!-- Task Title -->
                    <div class="task-card__title">
                        <field name="name"/>
                    </div>
                    
                    <!-- Task Meta -->
                    <div class="task-card__meta">
                        <span>
                            <t t-if="record.x_task_ref.raw_value">
                                <t t-esc="record.x_task_ref.value"/>
                            </t>
                        </span>
                        <span>
                            <t t-if="record.progress.raw_value">
                                <t t-esc="record.progress.value"/>%
                            </t>
                        </span>
                    </div>
                    
                    <!-- Assignee Avatar -->
                    <div class="task-card__assignee" t-if="record.user_ids.raw_value">
                        <img t-att-src="kanban_image('res.users', 'avatar_128', record.user_ids.raw_value[0])" 
                             class="task-card__avatar" 
                             alt="Assignee"/>
                    </div>
                </div>
            </xpath>
        </field>
    </record>
    
    <!-- Dashboard Action -->
    <record id="action_finance_ppm_dashboard" model="ir.actions.act_window">
        <field name="name">Finance PPM Dashboard</field>
        <field name="res_model">project.task</field>
        <field name="view_mode">kanban,tree,form,gantt,calendar</field>
        <field name="context">{
            'search_default_group_by_stage': 1,
        }</field>
        <field name="domain">[]</field>
        <field name="help" type="html">
            <div class="empty-state">
                <div class="empty-state__title">Welcome to Finance PPM</div>
                <div class="empty-state__subtitle">
                    Create your first task to get started with the month-end closing process.
                </div>
                <p>
                    <a type="action" name="%(project.action_view_task)d" class="btn btn-primary">
                        Create Task
                    </a>
                </p>
            </div>
        </field>
    </record>
</odoo>
